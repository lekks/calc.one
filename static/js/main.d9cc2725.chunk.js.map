{"version":3,"sources":["calculator/Expression.ts","components/CalcButton.tsx","components/ExpressionPanel.tsx","components/ExpressionStack.tsx","components/InputPanel.tsx","calculator/Editor.ts","calculator/operations.ts","calculator/Calculator.ts","calculator/Stack.ts","components/App.tsx","serviceWorker.ts","index.tsx"],"names":["OperationRank","CalcButton","props","onClick","subject","next","type","action","payload","tag","onKeyDown","e","key","keybinding","document","addEventListener","removeEventListener","this","className","caption","React","Component","ExpressionPanel","expression","result","Number","toFixed","resStr","isNaN","String","texStr","texFormula","math","ExpressionStack","subscription","Subscription","state","expressions","add","exprStack","subscribe","setState","unsubscribe","reversed","slice","reverse","map","expr","index","Fragment","InputPanel","text","CLEAR_SYMBOL","BS_SYMBOL","Editor","extern","symbolInput","Subject","stringInput","value","subscriptions","outputText","outputValue","inputSymbols","inputString","pipe","mergeAll","filter","allowedSymbols","includes","scan","symbolReducer","str","length","NaN","acc","indexOf","NumberExpression","tex","result_value","toString","parseFloat","NUMBER","buildOperandTexStr","toEmbrace","getTex","ArithmeticExpression","calc","rank","associative","explicitTexParentheses","left","right","tex_formula","buildTex","getResult","getRank","builder","needLeftParenthesis","useExplicitTexParentheses","needRightParenthesis","FunctionExpression","arg","FUNC","UnaryMinusExpression","Operations","operation","operands","operationsTable","build","operandsNumber","a","b","PLUS_MINUS","MULT__DIV","leftExpr","rightExpr","x","Math","sqrt","getArg","CalcInputType","Stack","expressionStack","stack","history","asObservable","popHistory","publishStack","last","pop","num","stashHistory","splice","push","Calculator","calcResult","editorText","BehaviorSubject","editorValue","editorInputSymbols","editorInputString","editor","inputEvent","processInputEvent","bind","editorTextInput","getExpressionsObservable","undefined","combineLatest","distinctUntilChanged","stackResult","destroy","getValue","oper","ops","defined","stackGet","editorNotEmpty","getLength","operandsExpr","getTop","editorExpression","addOperation","buildExpression","event","ADD_NUMBER","OPERATION","DEL","del","CLEAR","clear","BS","backSpace","ENTER","duplicate","SWAP","swap","calcInputEvent","calcEditorStringInput","calcEditorStringOutput","calcExpressionStack","App","isLocalhost","Boolean","window","location","hostname","match","registerValidSW","swUrl","config","navigator","serviceWorker","register","then","registration","onupdatefound","installingWorker","installing","onstatechange","controller","console","log","onUpdate","onSuccess","catch","error","clipboardData","string","getData","preventDefault","setData","ReactDOM","render","getElementById","URL","process","href","origin","fetch","response","contentType","headers","get","status","ready","unregister","reload","checkValidServiceWorker"],"mappings":"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","file":"static/js/main.d9cc2725.chunk.js","sourcesContent":["export enum OperationRank {\n    PLUS_MINUS,\n    MULT__DIV,\n    FUNC,\n    NUMBER\n}\n\nexport type Result = number;\n\nexport interface Expression {\n    getResult(): Result;\n\n    getRank(): OperationRank;\n\n    getTex(): string;\n\n    useExplicitTexParentheses(): boolean;\n}\n\nexport class NumberExpression implements Expression {\n    private readonly tex: string;\n    private readonly result_value: number;\n\n    constructor(value: string | number) {\n        if (typeof value === 'number') {\n            this.tex = value.toString();\n            this.result_value = value;\n        } else {\n            this.result_value = parseFloat(value);\n            this.tex = value;\n        }\n    }\n\n    getResult(): Result {\n        return this.result_value;\n    }\n\n    getRank(): number {\n        return OperationRank.NUMBER\n    }\n\n    getTex(): string {\n        return this.tex;\n    }\n\n    useExplicitTexParentheses(): boolean {\n        return false;\n    }\n\n}\n\ntype ArithmeticTexBuilder = (leftStr: string, rightStr: string, leftExpr: Expression, rightExpr: Expression) => string;\n\nfunction buildOperandTexStr(expr: Expression, toEmbrace: boolean): string {\n    return toEmbrace ? `\\\\left(${expr.getTex()}\\\\right)` : `${expr.getTex()}`;\n}\n\nexport class ArithmeticExpression implements Expression {\n    private readonly tex_formula: string;\n    private readonly result_value: number;\n    private readonly explicitTexParentheses: boolean;\n\n    constructor(tex: ArithmeticTexBuilder,\n                calc: (...args: Result[]) => Result,\n                private readonly rank: OperationRank,\n                private readonly associative: boolean,\n                explicitTexParentheses: boolean,\n                private readonly left: Expression,\n                private readonly right: Expression) {\n        this.explicitTexParentheses = explicitTexParentheses;\n        this.tex_formula = this.buildTex(tex);\n        this.result_value = calc(left.getResult(), right.getResult());\n    }\n\n    getResult(): Result {\n        return this.result_value;\n    }\n\n    getRank(): OperationRank {\n        return this.rank;\n    }\n\n    getTex(): string {\n        return this.tex_formula;\n    }\n\n    useExplicitTexParentheses(): boolean {\n        return this.explicitTexParentheses;\n    }\n\n    private needLeftParenthesis(): boolean {\n        return this.rank > this.left.getRank()\n    }\n\n    private needRightParenthesis(): boolean {\n        return this.rank > this.right.getRank() || (!this.associative && this.rank === this.right.getRank())\n    }\n\n    private buildTex(builder: ArithmeticTexBuilder): string {\n        const leftStr = buildOperandTexStr(this.left, this.needLeftParenthesis() && this.left.useExplicitTexParentheses());\n        const rightStr = buildOperandTexStr(this.right, this.needRightParenthesis() && this.right.useExplicitTexParentheses());\n        return builder(leftStr, rightStr, this.left, this.right);\n    }\n}\n\nexport class FunctionExpression implements Expression {\n\n    private readonly tex_formula: string;\n    private readonly result_value: number;\n\n    constructor(\n        calc: (arg: Result) => Result,\n        buildTex: (arg: string, expr: Expression) => string,\n        private readonly arg: Expression) {\n        this.tex_formula = buildTex(buildOperandTexStr(arg, arg.useExplicitTexParentheses()), arg);\n        this.result_value = calc(arg.getResult());\n    }\n\n    getRank(): OperationRank {\n        return OperationRank.FUNC;\n    }\n\n    getTex(): string {\n        return this.tex_formula;\n    }\n\n    useExplicitTexParentheses(): boolean {\n        return false;\n    }\n\n    getResult(): number {\n        return this.result_value;\n    }\n\n}\n\n\nclass UnaryMinusExpression implements Expression {\n\n    private readonly tex_formula: string;\n    private readonly result_value: number;\n\n    constructor(\n        private readonly arg: Expression) {\n        this.tex_formula = `{-${buildOperandTexStr(arg, arg.useExplicitTexParentheses())}}`;\n        this.result_value = -arg.getResult();\n    }\n\n    getRank(): OperationRank {\n        return OperationRank.FUNC;\n    }\n\n    getTex(): string {\n        return this.tex_formula;\n    }\n\n    useExplicitTexParentheses(): boolean {\n        return true;\n    }\n\n    getResult(): number {\n        return this.result_value;\n    }\n\n    getArg(): Expression {\n        return this.arg;\n    }\n\n}\n\nexport function invertExpresson(arg: Expression) {\n    if (arg instanceof UnaryMinusExpression)\n        return arg.getArg();\n    else\n        return new UnaryMinusExpression(arg);\n}","import React from 'react';\nimport {Observer} from \"rxjs\";\nimport {CalcInputEvent, CalcInputType} from \"../calculator/Calculator\";\n\n\ninterface Props {\n    caption: string;\n    tag?: string;\n    action: CalcInputType;\n    keybinding?: string;\n    subject: Observer<CalcInputEvent>;\n}\n\nclass CalcButton extends React.Component<Props, any> {\n    constructor(props: Props) {\n        super(props,);\n        document.addEventListener(\"keydown\", this.onKeyDown)\n    }\n\n    public componentWillUnmount() {\n        document.removeEventListener(\"keydown\", this.onKeyDown);\n    }\n\n    public render() {\n        return (\n            <div onClick={this.onClick} className={\"Button\"}>\n                {this.props.caption}\n            </div>\n        );\n    }\n\n    private onClick = () => {\n        this.props.subject.next({type: this.props.action, payload: this.props.tag})\n    };\n\n    private onKeyDown = (e: KeyboardEvent) => {\n        if (e.key === this.props.keybinding) {\n            this.onClick()\n        }\n        // console.log(e)\n    }\n}\n\nexport default CalcButton;\n","import React from 'react';\n\nimport 'katex/dist/katex.min.css';\nimport {BlockMath} from 'react-katex';\nimport {StackItem} from \"../calculator/Calculator\";\n\nconst ROUND = 6;\n\ninterface Props {\n    expression: StackItem;\n}\n\nconst ExpressionPanel: React.FC<Props> = (expression) => {\n    const result = Number(expression.expression.result.toFixed(ROUND));\n    const resStr: string = isNaN(result) ? \"?\" : String(result);\n    //Choosing fonts (overrides ,katex): https://katex.org/docs/supported.html#style-color-size-and-font\n    const texStr: string = `${expression.expression.texFormula}=${resStr}`;\n    return (\n        <div className=\"Expression\">\n            <BlockMath math={texStr}/>\n        </div>\n\n    );\n};\n\nexport default ExpressionPanel;\n","import React from 'react';\nimport ExpressionPanel from \"./ExpressionPanel\";\nimport {StackItem} from \"../calculator/Calculator\";\nimport {Observable, Subscription} from \"rxjs\";\n\ninterface State {\n    expressions: StackItem[];\n}\n\ninterface Props {\n    exprStack: Observable<StackItem[]>;\n}\n\nclass ExpressionStack extends React.Component<any, State> {\n    private readonly subscription = new Subscription();\n\n    constructor(props: Props) {\n        super(props,);\n        this.state = {expressions: []};\n        this.subscription.add(props.exprStack.subscribe((expressions) => {\n            this.setState({expressions})\n        }))\n    }\n\n    public componentWillUnmount() {\n        this.subscription.unsubscribe();\n    }\n\n    render() {\n        const reversed = this.state.expressions.slice().reverse();\n        return (\n            <div className=\"Stack\">\n                {reversed.map((expr: StackItem, index) =>\n                    <React.Fragment key={index}>\n                        {index ? <hr/> : null}\n                        <ExpressionPanel expression={expr}/>\n                    </React.Fragment>\n                )}\n            </div>\n        );\n    }\n}\n\nexport default ExpressionStack;\n","import React from 'react';\n\nimport {Observable, Subscription} from \"rxjs\";\n\ninterface State {\n    text: string;\n}\n\ninterface Props {\n    text: Observable<string>;\n}\n\nclass InputPanel extends React.Component<any, State> {\n    private readonly subscription = new Subscription();\n\n    constructor(props: Props) {\n        super(props,);\n        this.state = {text: \"\"};\n        this.subscription.add(props.text.subscribe((text) => {\n            this.setState({text})\n        }))\n\n    }\n\n    public componentWillUnmount() {\n        this.subscription.unsubscribe();\n    }\n\n    render() {\n        return (\n            <div className=\"Input\">\n                {this.state.text}\n            </div>\n        );\n    }\n\n}\n\nexport default InputPanel;\n","import {Observable, Observer, Subject, Subscription} from \"rxjs\";\nimport {filter, map, mergeAll, scan} from \"rxjs/operators\";\n\nexport interface EditorSignals {\n    outputText?: Observer<string>,\n    outputValue?: Observer<number>,\n    inputSymbols?: Observable<string>,\n    inputString?: Observable<string>\n}\n\nexport const CLEAR_SYMBOL = \"DEL\"\nexport const BS_SYMBOL = \"BS\"\n\nexport class Editor {\n    private static readonly allowedSymbols: string[] = [\n        '.', ',', '0', '1', '2', '3', '4', '5', '6', '7', '8', '9',\n        CLEAR_SYMBOL, BS_SYMBOL\n    ];\n    private readonly symbolInput = new Subject<string>();\n    private readonly stringInput = new Subject<string>();\n    private readonly expression = new Subject<string>();\n    private readonly value = new Subject<number>();\n\n    private subscriptions: Subscription = new Subscription();\n\n    constructor(extern: EditorSignals) {\n        this.subscriptions.add(this.expression.subscribe(extern.outputText))\n        this.subscriptions.add(this.value.subscribe(extern.outputValue))\n        this.subscriptions.add(extern.inputSymbols?.subscribe(this.symbolInput))\n        this.subscriptions.add(extern.inputString?.subscribe(this.stringInput))\n\n        this.subscriptions.add(this.stringInput.pipe(mergeAll()).subscribe(this.symbolInput))\n        this.subscriptions.add(this.symbolInput.pipe(\n            filter(value => Editor.allowedSymbols.includes(value)),\n            scan(Editor.symbolReducer, \"\")\n        ).subscribe(this.expression))\n        this.subscriptions.add(this.expression.pipe(map(str => str.length ? Number(str) : NaN)).subscribe(this.value))\n    }\n\n    public destroy() {\n        this.subscriptions.unsubscribe()\n    }\n\n    private static symbolReducer(acc: string, expr: string) {\n        if (expr === BS_SYMBOL) {\n            if (acc.length > 0) {\n                return acc.slice(0, -1);\n            } else {\n                return acc;\n            }\n        }\n        if (expr === CLEAR_SYMBOL) {\n            return \"\"\n        }\n        if (expr === ',')\n            expr = '.'\n        if (expr === '.' && acc.indexOf(expr) !== -1)\n            return acc;\n        return acc + expr;\n    }\n\n}\n","import {ArithmeticExpression, Expression, FunctionExpression, invertExpresson, OperationRank,} from \"./Expression\";\n\n\ninterface OptParam {\n    operandsNumber: number,\n\n    build(...operands: Expression[]): Expression,\n}\n\nexport default class Operations {\n    static readonly operationsTable: { [opt: string]: OptParam } = {\n        \"+\": {\n            operandsNumber: 2,\n            build: function (a: Expression, b: Expression) {\n                return new ArithmeticExpression((a, b) => `${a}+${b}`, (a, b) => a + b, OperationRank.PLUS_MINUS, true, true, a, b)\n            },\n        },\n        \"-\": {\n            operandsNumber: 2,\n            build: function (a: Expression, b: Expression) {\n                return new ArithmeticExpression((a, b) => `${a}-${b}`, (a, b) => a - b, OperationRank.PLUS_MINUS, false, true, a, b)\n            },\n        },\n        \"*\": {\n            operandsNumber: 2,\n            build: function (a: Expression, b: Expression) {\n                return new ArithmeticExpression((a, b) => `${a}\\\\times${b}`, (a, b) => a * b, OperationRank.MULT__DIV, true, true, a, b)\n            },\n        },\n        \"/\": {\n            operandsNumber: 2,\n            build: function (a: Expression, b: Expression) {\n                return new ArithmeticExpression((a, b, leftExpr, rightExpr) => `\\\\frac{${leftExpr.getTex()}}{${rightExpr.getTex()}}`, (a, b) => a / b, OperationRank.MULT__DIV, false, true, a, b)\n            },\n        },\n        \"sqrt\": {\n            operandsNumber: 1,\n            build: function (x: Expression) {\n                return new FunctionExpression((x) => Math.sqrt(x), (a, x) => `\\\\sqrt{${x.getTex()}}`, x)\n            },\n        },\n        \"sqr\": {\n            operandsNumber: 1,\n            build: function (x: Expression) {\n                return new FunctionExpression((x) => x * x, (x) => `{${x}}^2`, x)\n            },\n        },\n        \"uminus\": {\n            operandsNumber: 1,\n            build: function (x: Expression) {\n                return invertExpresson(x)\n            },\n\n        }\n    };\n\n    static buildExpression(operation: string, ...operands: Expression[]): Expression {\n        return this.operationsTable[operation].build(...operands)\n    }\n\n    static operandsNumber(operation: string): number {\n        return this.operationsTable[operation].operandsNumber;\n    }\n\n    static defined(operation: string): boolean {\n        return operation in this.operationsTable;\n    }\n}\n\n","import {BS_SYMBOL, CLEAR_SYMBOL, Editor} from \"./Editor\";\nimport {Expression, NumberExpression} from \"./Expression\";\nimport ops from \"./operations\";\nimport {BehaviorSubject, combineLatest, Observable, Observer, Subject, Subscription} from \"rxjs\"\nimport {distinctUntilChanged, map} from \"rxjs/operators\";\nimport {Stack} from \"./Stack\";\n\n\nexport enum CalcInputType {\n    ADD_NUMBER,\n    OPERATION,\n    ENTER,\n    SWAP,\n    BS,\n    DEL,\n    CLEAR\n}\n\nexport interface CalcInputEvent {\n    type: CalcInputType;\n    payload?: string;\n}\n\nexport interface StackItem {\n    readonly texFormula: string\n    readonly result: number\n}\n\nexport interface CalculatorSignals {\n    inputEvent?: Observable<CalcInputEvent>,\n    editorTextInput?: Observable<string>,\n    result?: Observer<number>\n    editorText?: Observer<string>,\n    expressionStack?: Observer<StackItem[]>\n    stackResult?: Observer<StackItem | undefined>;\n}\n\nexport class Calculator {\n\n    private readonly calcResult = new Subject<StackItem | undefined>();\n    private readonly expressionStack = new Subject<StackItem[]>();\n    private readonly stack = new Stack();\n    private readonly editorText = new BehaviorSubject<string>(\"\")\n    private readonly editorValue = new BehaviorSubject<number>(NaN)\n    private readonly editorInputSymbols = new Subject<string>();\n    private readonly editorInputString = new Subject<string>();\n    private readonly editor: Editor;\n    private subscriptions: Subscription = new Subscription();\n\n    constructor(extern: CalculatorSignals) {\n\n        this.editor = new Editor({\n            outputText: this.editorText,\n            inputSymbols: this.editorInputSymbols,\n            inputString: this.editorInputString,\n            outputValue: this.editorValue\n        });\n\n        this.subscriptions.add(extern.inputEvent?.subscribe(this.processInputEvent.bind(this)))\n        this.subscriptions.add(extern.editorTextInput?.subscribe(this.editorInputString))\n\n        this.subscriptions.add(this.stack.getExpressionsObservable().pipe(\n            map((exprStack: Expression[]): StackItem[] => exprStack.map((expr: Expression): StackItem => {\n                return {\n                    texFormula: expr.getTex(),\n                    result: expr.getResult()\n                }\n            }))\n        ).subscribe(this.expressionStack))\n\n        this.subscriptions.add(this.expressionStack.pipe(\n            map((stack: StackItem[]) =>\n                stack[stack.length - 1] ? stack[stack.length - 1] : undefined\n            )\n        ).subscribe(this.calcResult))\n\n        this.subscriptions.add(combineLatest([this.editorValue, this.calcResult]).pipe(\n            map(([editor, stack]) => {\n                return !isNaN(editor) ? editor : (stack ? stack.result : NaN)\n            }),\n            distinctUntilChanged()\n        ).subscribe(extern.result))\n        this.subscriptions.add(this.expressionStack.subscribe(extern.expressionStack))\n        this.subscriptions.add(this.calcResult.subscribe(extern.stackResult))\n        this.subscriptions.add(this.editorText.subscribe(extern.editorText))\n    }\n\n    public destroy() {\n        this.editor.destroy()\n        this.subscriptions.unsubscribe()\n    }\n\n    private editorExpression(): Expression {\n        return new NumberExpression(this.editorText.getValue())\n    }\n\n    private editorNotEmpty(): boolean {\n        return this.editorText.getValue().length !== 0;\n    }\n\n    private addOperation(oper: string) {\n        // operation is unknown\n        if (!ops.defined(oper)) {\n            return\n        }\n\n        // we must have in stack as much items as we need for operation\n        const opnNum: number = ops.operandsNumber(oper);\n        const stackGet = opnNum - (this.editorNotEmpty() ? 1 : 0);\n        if (stackGet > this.stack.getLength()) {\n            return\n        }\n\n        const operandsExpr: Expression[] = this.stack.getTop(stackGet)\n\n        if (this.editorNotEmpty()) {\n            operandsExpr.push(this.editorExpression());\n            this.editorInputSymbols.next(CLEAR_SYMBOL);\n        }\n        this.stack.addOperation(ops.buildExpression(oper, ...operandsExpr));\n    }\n\n    private processInputEvent(event: CalcInputEvent) {\n        switch (event.type) {\n            case CalcInputType.ADD_NUMBER:\n                event.payload && this.editorInputSymbols.next(event.payload);\n                break;\n            case CalcInputType.OPERATION:\n                event.payload && this.addOperation(event.payload);\n                break;\n            case CalcInputType.DEL:\n                if (this.editorNotEmpty()) {\n                    this.editorInputSymbols.next(CLEAR_SYMBOL);\n                } else {\n                    this.stack.del()\n                }\n                break;\n            case CalcInputType.CLEAR:\n                this.editorInputSymbols.next(CLEAR_SYMBOL);\n                this.stack.clear()\n                break;\n            case CalcInputType.BS:\n                if (this.editorNotEmpty()) {\n                    this.editorInputSymbols.next(BS_SYMBOL)\n                } else {\n                    this.stack.backSpace()\n                }\n                break;\n            case CalcInputType.ENTER:\n                if (this.editorNotEmpty()) {\n                    this.stack.push(this.editorExpression());\n                    this.editorInputSymbols.next(CLEAR_SYMBOL);\n                } else {\n                    this.stack.duplicate()\n                }\n                break;\n            case CalcInputType.SWAP:\n                if (this.editorNotEmpty()) {\n                    this.stack.push(this.editorExpression());\n                    this.editorInputSymbols.next(CLEAR_SYMBOL);\n                }\n                this.stack.swap();\n                break;\n        }\n    }\n}","import {Observable, Subject} from \"rxjs\";\nimport {Expression} from \"./Expression\";\n\nexport class Stack {\n    private readonly expressionStack = new Subject<Expression[]>();\n    private stack: Expression[] = [];\n    private history: Expression[][] = [];\n\n    public getExpressionsObservable(): Observable<Expression[]> {\n        return this.expressionStack.asObservable();\n    }\n\n    public backSpace() {\n        if (this.popHistory()) {\n            this.publishStack()\n        }\n    }\n\n    public popHistory(): boolean {\n        const last = this.history.pop();\n\n        if (last) {\n            this.stack = last;\n            return true;\n        } else {\n            return false\n        }\n    }\n\n    public getLength() {\n        return this.stack.length\n    }\n\n    public getTop(num: number): Expression[] {\n        this.stashHistory();\n        return this.stack.splice(-num, num);\n    }\n\n    public addOperation(expr: Expression) {\n        this.stack.push(expr);\n        this.publishStack()\n    }\n\n    public push(expr: Expression) {\n        this.stashHistory();\n        this.stack.push(expr);\n        this.publishStack()\n    }\n\n    public duplicate() {\n        if (this.stack.length > 0) {\n            this.stashHistory();\n            this.stack.push(this.stack[this.stack.length - 1]);\n            this.publishStack()\n        }\n    }\n\n    public swap() {\n        if (this.stack.length >= 2) {\n            this.stashHistory();\n            [this.stack[this.stack.length - 1], this.stack[this.stack.length - 2]] = [this.stack[this.stack.length - 2], this.stack[this.stack.length - 1]];\n            this.publishStack()\n        }\n    }\n\n    public clear() {\n        this.history = [];\n        this.stack = [];\n        this.publishStack()\n    }\n\n    public del() {\n        if (this.stack.length > 0) {\n            this.stashHistory();\n            this.stack.pop();\n            this.publishStack()\n        }\n    }\n\n    private publishStack() {\n        this.expressionStack.next(this.stack)\n    }\n\n    private stashHistory() {\n        this.history.push([...this.stack]);\n    }\n\n\n}","import React from 'react';\nimport CalcButton from './CalcButton';\nimport ExpressionStack from \"./ExpressionStack\";\nimport InputPanel from \"./InputPanel\";\nimport './App.css';\nimport {CalcInputEvent, CalcInputType, Calculator, StackItem} from \"../calculator/Calculator\";\nimport {BehaviorSubject, Subject} from \"rxjs\";\n\nconst CLIPBOARD_ROUND = 8;\n\nconst calcInputEvent = new Subject<CalcInputEvent>();\nconst calcEditorStringInput = new Subject<string>();\nconst calcEditorStringOutput = new Subject<string>();\nconst calcResult = new BehaviorSubject<number>(NaN);\nconst calcExpressionStack = new Subject<StackItem[]>()\n\nnew Calculator({\n    inputEvent: calcInputEvent,\n    editorTextInput: calcEditorStringInput,\n    result: calcResult,\n    editorText: calcEditorStringOutput,\n    expressionStack: calcExpressionStack\n});\n\nconst App: React.FC = () => {\n    return (\n        <div className=\"App\">\n            <ExpressionStack exprStack={calcExpressionStack}/>\n            <InputPanel text={calcEditorStringOutput}/>\n            <div className=\"Pad\">\n                <table className=\"Buttons\">\n                    <tbody>\n                    {/*<tr>*/}\n                    {/*    <td/><td/><td/><td/>*/}\n                    {/*    <td>*/}\n                    {/*        <div className={\"Button\"} onClick={(event: any) => { console.log(\"PASTE\") }}>*/}\n                    {/*            Paste*/}\n                    {/*        </div>*/}\n                    {/*    </td>*/}\n                    {/*</tr>*/}\n                    <tr>\n                        <td className=\"Num\"><CalcButton caption=\"7\" tag=\"7\" keybinding=\"7\"\n                                                        action={CalcInputType.ADD_NUMBER}\n                                                        subject={calcInputEvent}/>\n                        </td>\n                        <td className=\"Num\"><CalcButton caption=\"8\" tag=\"8\" keybinding=\"8\"\n                                                        action={CalcInputType.ADD_NUMBER}\n                                                        subject={calcInputEvent}/>\n                        </td>\n                        <td className=\"Num\"><CalcButton caption=\"9\" tag=\"9\" keybinding=\"9\"\n                                                        action={CalcInputType.ADD_NUMBER}\n                                                        subject={calcInputEvent}/>\n                        </td>\n                        <td><CalcButton caption=\"/\" tag=\"/\" keybinding=\"/\" action={CalcInputType.OPERATION}\n                                        subject={calcInputEvent}/></td>\n                        <td><CalcButton caption=\"<-\" keybinding=\"Backspace\" action={CalcInputType.BS}\n                                        subject={calcInputEvent}/></td>\n                    </tr>\n                    <tr>\n                        <td className=\"Num\"><CalcButton caption=\"4\" tag=\"4\" keybinding=\"4\"\n                                                        action={CalcInputType.ADD_NUMBER}\n                                                        subject={calcInputEvent}/>\n                        </td>\n                        <td className=\"Num\"><CalcButton caption=\"5\" tag=\"5\" keybinding=\"5\"\n                                                        action={CalcInputType.ADD_NUMBER}\n                                                        subject={calcInputEvent}/>\n                        </td>\n                        <td className=\"Num\"><CalcButton caption=\"6\" tag=\"6\" keybinding=\"6\"\n                                                        action={CalcInputType.ADD_NUMBER}\n                                                        subject={calcInputEvent}/>\n                        </td>\n                        <td><CalcButton caption=\"*\" tag=\"*\" keybinding=\"*\" action={CalcInputType.OPERATION}\n                                        subject={calcInputEvent}/></td>\n                        <td><CalcButton caption=\"Del\" tag=\"clear\" keybinding=\"Delete\" action={CalcInputType.DEL}\n                                        subject={calcInputEvent}/></td>\n                    </tr>\n                    <tr>\n                        <td className=\"Num\"><CalcButton caption=\"1\" tag=\"1\" keybinding=\"1\"\n                                                        action={CalcInputType.ADD_NUMBER}\n                                                        subject={calcInputEvent}/>\n                        </td>\n                        <td className=\"Num\"><CalcButton caption=\"2\" tag=\"2\" keybinding=\"2\"\n                                                        action={CalcInputType.ADD_NUMBER}\n                                                        subject={calcInputEvent}/>\n                        </td>\n                        <td className=\"Num\"><CalcButton caption=\"3\" tag=\"3\" keybinding=\"3\"\n                                                        action={CalcInputType.ADD_NUMBER}\n                                                        subject={calcInputEvent}/>\n                        </td>\n                        <td><CalcButton caption=\"-\" tag=\"-\" keybinding=\"-\" action={CalcInputType.OPERATION}\n                                        subject={calcInputEvent}/></td>\n                        <td><CalcButton caption=\"Swap\" keybinding=\"PageDown\" action={CalcInputType.SWAP}\n                                        subject={calcInputEvent}/></td>\n                    </tr>\n                    <tr>\n                        <td className=\"Num\"><CalcButton caption=\"0\" tag=\"0\" keybinding=\"0\"\n                                                        action={CalcInputType.ADD_NUMBER}\n                                                        subject={calcInputEvent}/>\n                        </td>\n                        <td className=\"Num\"><CalcButton caption=\".\" tag=\".\" keybinding=\".\"\n                                                        action={CalcInputType.ADD_NUMBER}\n                                                        subject={calcInputEvent}/>\n                        </td>\n                        <td/>\n                        <td><CalcButton caption=\"+\" tag=\"+\" keybinding=\"+\" action={CalcInputType.OPERATION}\n                                        subject={calcInputEvent}/></td>\n                        <td><CalcButton caption=\"Reset\" keybinding=\"Escape\" action={CalcInputType.CLEAR}\n                                        subject={calcInputEvent}/></td>\n                    </tr>\n                    <tr>\n                        <td><CalcButton caption=\"√\" tag=\"sqrt\" keybinding=\"\\\" action={CalcInputType.OPERATION}\n                                        subject={calcInputEvent}/></td>\n                        <td><CalcButton caption=\"x²\" tag=\"sqr\" action={CalcInputType.OPERATION}\n                                        subject={calcInputEvent}/></td>\n                        <td><CalcButton caption=\"-x\" tag=\"uminus\" action={CalcInputType.OPERATION}\n                                        subject={calcInputEvent}/></td>\n                        <td/>\n                        <td><CalcButton caption=\"Enter\" keybinding=\"Enter\" action={CalcInputType.ENTER}\n                                        subject={calcInputEvent}/></td>\n                    </tr>\n                    </tbody>\n                </table>\n            </div>\n        </div>\n    );\n};\n\n\nexport function registerClipboardSupport() {\n\n    function toSeasonableString(x: number): string {\n        return String(Number(x.toFixed(CLIPBOARD_ROUND)))\n    }\n\n    window.document.addEventListener('paste', (e) => {\n        if (e.clipboardData) {\n            const string = e.clipboardData.getData('text/plain');\n            calcEditorStringInput.next(string)\n        }\n        e.preventDefault();\n    });\n\n    window.document.addEventListener('copy', (e) => {\n        const result = calcResult.getValue();\n        if (!isNaN(result)) {\n            e.clipboardData && e.clipboardData.setData('text/plain', toSeasonableString(result));\n        }\n        e.preventDefault();\n    });\n}\n\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      (process as { env: { [key: string]: string } }).env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App, {registerClipboardSupport} from './components/App';\nimport * as serviceWorker from './serviceWorker';\n\nregisterClipboardSupport();\nReactDOM.render(<App/>, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\n// serviceWorker.unregister();\nserviceWorker.register();\n"],"sourceRoot":""}